<!DOCTYPE html>
<html lang="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uw wachttijd</title>

<style>
  body {
    font-family: Arial, sans-serif;
    padding: 30px;
    text-align: center;
    max-width: 420px;
    margin: auto;
  }

  h1 {
    margin-bottom: 15px;
  }

  .timer {
    font-size: 48px;
    font-weight: bold;
    margin: 20px 0;
    color: black;
  }

  .timer.rood {
    color: red;
  }

  .terugkomtijd {
    font-size: 20px;
    color: #555;
    margin-top: 6px;
  }

  .instructie {
    font-size: 18px;
    margin-top: 25px;
  }
</style>
</head>

<body>

<h1 id="titel"></h1>

<div class="timer" id="timer">--</div>
<div class="terugkomtijd" id="terugkomtijd"></div>
<div class="instructie" id="instructie"></div>

<script>
/* -------------------------------
   Parameters
-------------------------------- */
const params = new URLSearchParams(window.location.search);
const endTs = Number(params.get("end"));
const onderzoek = params.get("onderzoek");
const lang = params.get("lang") || "nl";

/* -------------------------------
   Teksten
-------------------------------- */
const teksten = {
  nl: {
    titel: "Uw wachttijd",
    terug: "Terugkomen om",
    botscan: {
      start: "Gelieve enkele glazen water te drinken.",
      vijfmin: "U mag zich begeven naar wachtzaal D0W3.\nGelieve net voor het onderzoek uw blaas te ledigen."
    },
    schildklier: {
      start: "Gelieve plaats te nemen in de wachtzaal.",
      vijfmin: "U mag zich begeven naar wachtzaal D0W3."
    },
    mibi: {
      start: "Gelieve een vettig ontbijt te nemen (boterham met kaas of salami).",
      vijfmin: "U mag zich begeven naar wachtzaal D0W3."
    }
  },

  fr: {
    titel: "Votre temps d’attente",
    terug: "Revenir à",
    botscan: {
      start: "Veuillez boire plusieurs verres d’eau.",
      vijfmin: "Vous pouvez vous rendre à la salle d’attente D0W3.\nVeuillez vider votre vessie avant l’examen."
    },
    schildklier: {
      start: "Veuillez prendre place dans la salle d’attente.",
      vijfmin: "Vous pouvez vous rendre à la salle d’attente D0W3."
    },
    mibi: {
      start: "Veuillez prendre un petit-déjeuner gras (fromage ou salami).",
      vijfmin: "Vous pouvez vous rendre à la salle d’attente D0W3."
    }
  },

  en: {
    titel: "Your waiting time",
    terug: "Please return at",
    botscan: {
      start: "Please drink several glasses of water.",
      vijfmin: "You may proceed to waiting room D0W3.\nPlease empty your bladder before the examination."
    },
    schildklier: {
      start: "Please take a seat in the waiting area.",
      vijfmin: "You may proceed to waiting room D0W3."
    },
    mibi: {
      start: "Please eat a fatty breakfast (cheese or salami sandwich).",
      vijfmin: "You may proceed to waiting room D0W3."
    }
  },

  uk: {
    titel: "Ваш час очікування",
    terug: "Повернутися о",
    botscan: {
      start: "Будь ласка, випийте кілька склянок води.",
      vijfmin: "Ви можете пройти до зали очікування D0W3.\nСпорожніть сечовий міхур перед обстеженням."
    },
    schildklier: {
      start: "Будь ласка, сядьте в залі очікування.",
      vijfmin: "Ви можете пройти до зали очікування D0W3."
    },
    mibi: {
      start: "Будь ласка, з’їжте жирний сніданок (бутерброд з сиром або салямі).",
      vijfmin: "Ви можете пройти до зали очікування D0W3."
    }
  }
};

const t = teksten[lang] || teksten.nl;

/* -------------------------------
   Titel & startboodschap
-------------------------------- */
document.getElementById("titel").textContent = t.titel;
document.getElementById("instructie").textContent =
  t[onderzoek]?.start || "";

/* -------------------------------
   Exact uur
-------------------------------- */
const eindDatum = new Date(endTs);
const uurTekst =
  String(eindDatum.getHours()).padStart(2,"0") + ":" +
  String(eindDatum.getMinutes()).padStart(2,"0");

document.getElementById("terugkomtijd").textContent =
  `${t.terug} ${uurTekst}`;

/* -------------------------------
   Vibratie: iOS-passieve activatie
-------------------------------- */
let vibratieToegelaten = false;

// eerste willekeurige tik is voldoende
document.addEventListener("touchstart", () => {
  vibratieToegelaten = true;
}, { once: true });

document.addEventListener("click", () => {
  vibratieToegelaten = true;
}, { once: true });

/* -------------------------------
   Timer
-------------------------------- */
let vijfMinGetoond = false;

function updateTimer() {
  const nu = Date.now();
  const resterend = endTs - nu;

  if (resterend <= 0) {
    document.getElementById("timer").textContent = "00:00";
    return;
  }

  const totaalMin = Math.floor(resterend / 60000);
  const uren = Math.floor(totaalMin / 60);
  const minuten = totaalMin % 60;

  document.getElementById("timer").textContent =
    uren > 0
      ? `${uren} h ${String(minuten).padStart(2,"0")} min`
      : `${minuten} min`;

  if (resterend <= 5 * 60000 && !vijfMinGetoond) {
    vijfMinGetoond = true;

    document.getElementById("timer").classList.add("rood");
    document.getElementById("instructie").textContent =
      t[onderzoek]?.vijfmin || "";

    if (navigator.vibrate && vibratieToegelaten) {
      navigator.vibrate([300,200,300]);
    }
  }
}

updateTimer();
setInterval(updateTimer, 1000);
</script>

</body>
</html>
