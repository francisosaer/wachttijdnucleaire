<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Uw wachttijd</title>

<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 30px;
    background: #f7f9fb;
  }

  h1 {
    margin-bottom: 15px;
  }

  #timer {
    font-size: 3em;
    font-weight: bold;
    margin: 15px 0;
  }

  .timer-rood {
    color: #c62828;
  }

  #exactTijd {
    font-size: 1.3em;
    color: #444;
    margin-bottom: 15px;
  }

  #instructie {
    font-size: 1.2em;
    margin-top: 15px;
    color: #333;
  }

  .boodschap-groen {
    color: #2e7d32;
    font-weight: 600;
    font-size: 1.25em;
    margin-top: 25px;
    opacity: 0;
    transition: opacity 0.8s ease-in;
  }

  .fade-in {
    opacity: 1;
  }
</style>
</head>

<body>

<h1 id="titel"></h1>

<div id="exactTijd"></div> <!-- Terugkomtijd bovenaan -->
<div id="timer">--</div>
<div id="instructie"></div>
<div id="boodschap" class="boodschap-groen"></div>

<script>
/* ===== URL PARAMETERS ===== */
const params = new URLSearchParams(window.location.search);
const endTs = Number(params.get("end"));
const onderzoek = params.get("onderzoek") || "botscan";
const lang = params.get("lang") || "nl";

/* ===== VERTALINGEN ===== */
const vertalingen = {
  nl: {
    titel: "Uw wachttijd",
    instructies: {
      botscan: "Gelieve enkele glazen water te drinken.",
      schildklier: "Gelieve plaats te nemen in de wachtzaal.",
      mibi: "Gelieve een vettig ontbijt te nemen (boterham met kaas of salami)."
    },
    naarWachtzaal: "U mag zich begeven naar de wachtzaal DOW3."
  },
  fr: {
    titel: "Votre temps d’attente",
    instructies: {
      botscan: "Veuillez boire plusieurs verres d’eau.",
      schildklier: "Veuillez prendre place dans la salle d’attente.",
      mibi: "Veuillez prendre un petit-déjeuner gras (pain avec fromage ou salami)."
    },
    naarWachtzaal: "Veuillez vous rendre dans la salle d’attente DOW3."
  },
  en: {
    titel: "Your waiting time",
    instructies: {
      botscan: "Please drink several glasses of water.",
      schildklier: "Please take a seat in the waiting area.",
      mibi: "Please have a fatty breakfast (bread with cheese or salami)."
    },
    naarWachtzaal: "Please proceed to the waiting area DOW3."
  },
  uk: {
    titel: "Час очікування",
    instructies: {
      botscan: "Будь ласка, випийте кілька склянок води.",
      schildklier: "Будь ласка, займіть місце в залі очікування.",
      mibi: "Будь ласка, з’їжте жирний сніданок (хліб з сиром або салямі)."
    },
    naarWachtzaal: "Будь ласка, пройдіть до зали очікування DOW3."
  }
};

/* ===== ELEMENTEN ===== */
const timerEl = document.getElementById("timer");
const exactTijdEl = document.getElementById("exactTijd");
const instructieEl = document.getElementById("instructie");
const boodschapEl = document.getElementById("boodschap");

/* ===== TITEL & INSTRUCTIE ===== */
document.getElementById("titel").textContent =
  vertalingen[lang]?.titel || vertalingen.nl.titel;

instructieEl.textContent =
  vertalingen[lang]?.instructies[onderzoek] ||
  vertalingen.nl.instructies.botscan;

/* ===== EXACT TERUGKOMTIJD ===== */
const eindDatum = new Date(endTs);
exactTijdEl.textContent = "Terugkomtijd: " + 
  eindDatum.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });

/* ===== TIMER ===== */
let meldingGetoond = false;
let trillingGedaan = false;

function formatTijd(ms) {
  const s = Math.max(0, Math.floor(ms / 1000));
  const h = Math.floor(s / 3600);
  const m = Math.floor((s % 3600) / 60);
  const sec = s % 60;

  return (h > 0 ? `${h}u ` : "") + `${m} min ${sec.toString().padStart(2,"0")} s`;
}

function updateTimer() {
  const resterend = endTs - Date.now();
  timerEl.textContent = formatTijd(resterend);

  if (resterend <= 5*60*1000) {
    timerEl.classList.add("timer-rood");

    if (!meldingGetoond) {
      boodschapEl.textContent = vertalingen[lang].naarWachtzaal;
      boodschapEl.classList.add("fade-in");
      meldingGetoond = true;
    }

    if (!trillingGedaan && navigator.vibrate) {
      navigator.vibrate([300,200,300]);
      trillingGedaan = true;
    }
  }

  if (resterend <= 0) {
    timerEl.textContent = "0 min 00 s";
  }
}

updateTimer();
setInterval(updateTimer,1000);
</script>

</body>
</html>
