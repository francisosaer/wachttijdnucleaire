<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wachttijd instellen</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 400px; margin:auto; text-align:center; }
  h1 { font-size: 24px; margin-bottom: 20px; }
  label, input, select, button { display: block; width: 100%; margin: 10px 0; font-size: 18px; padding: 8px; }
  button { cursor: pointer; }
  #linkOutput { margin-top: 20px; word-break: break-word; color: blue; }
  #qrcode canvas { margin-top: 10px; }
  .scan-option {
    display:flex;
    align-items:center;
    padding:10px;
    border-radius:6px;
    margin-bottom:10px;
    cursor:pointer;
    background-color:#f2f2f2;
    transition: background-color 0.3s;
  }
  .scan-option.selected { background-color:#007BFF; color:white; }
  .scan-option span { margin-left:10px; }
</style>
</head>
<body>

<h1>Selecteer terugkomtijd</h1>

<input type="time" id="time" required placeholder="HH:MM">

<label><strong>Selecteer onderzoek:</strong></label>
<div id="onderzoeken">
  <div class="scan-option" data-scan="botscan">üíÄ <span>Botscan</span></div>
  <div class="scan-option" data-scan="schildklier">ü¶ã <span>Schildklierscan</span></div>
  <div class="scan-option" data-scan="mibi">‚ù§Ô∏è <span>MIBI-scan</span></div>
</div>

<label>Taal:</label>
<select id="taal">
  <option value="nl">Nederlands</option>
  <option value="fr">Frans</option>
  <option value="en">Engels</option>
  <option value="uk">Oekra√Øens</option>
</select>

<label>Telefoonnummer pati√´nt:</label>
<input type="tel" id="phone" placeholder="04" required pattern="[0-9]{8,9}" maxlength="10">

<button onclick="verstuurLink()">Genereer link & verstuur SMS</button>

<div id="linkOutput"></div>
<div id="qrcode"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
let selectedScan = null;

// Onderzoek selecteren
document.querySelectorAll('.scan-option').forEach(div => {
  div.addEventListener('click', ()=>{
    selectedScan = div.getAttribute('data-scan');
    document.querySelectorAll('.scan-option').forEach(d=>d.classList.remove('selected'));
    div.classList.add('selected');
  });
});

function verstuurLink(){
  const timeInput = document.getElementById('time').value;
  let phone = document.getElementById('phone').value.trim();
  const taal = document.getElementById('taal').value;

  if(!timeInput || !phone || !selectedScan){
    alert('Vul tijd, telefoonnummer en onderzoekstype in!');
    return;
  }

  // Belgi√´: vervang eerste 0 door +32 als het begint met 0
  if(phone.startsWith('0')){
    phone = '+32'+phone.substring(1);
  }

  const [u,m] = timeInput.split(':').map(Number);
  const now = new Date();
  let eindTijd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), u, m,0);
  if(eindTijd<now) eindTijd.setDate(eindTijd.getDate()+1);
  const endTs = eindTijd.getTime();

  // Link naar uw-wachttijd.html op GitHub Pages
  const link = `https://francisosaer.github.io/wachttijdnucleaire/uw-wachttijd.html?end=${endTs}&onderzoek=${selectedScan}&lang=${taal}&v=${Date.now()}`;

  // Open SMS-app direct op smartphone
  window.location.href = `sms:${phone}?body=Uw%20wachttijd:%20${encodeURIComponent(link)}`;

  // Toon link + QR-code
  document.getElementById('linkOutput').innerHTML = `<p>Link: <a href="${link}" target="_blank">${link}</a></p>`;
  QRCode.toCanvas(document.getElementById('qrcode'), link, function(error){
    if(error) console.error(error);
  });
}
</script>

</body>
</html>
