<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wachttijd instellen v1.0</title>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 500px;
  margin: auto;
  padding: 20px;
}
h1 { text-align:center; }
label, select, input, button {
  display:block;
  width: 100%;
  max-width: 300px;
  margin: 10px auto;
  font-size: 16px;
  padding: 8px;
}
#onderzoek select { width: 100%; }
#smsLink {
  display:none;
  text-align:center;
  margin-top:15px;
  background:#007bff;
  color:white;
  padding:12px;
  text-decoration:none;
  border-radius:6px;
  font-size:16px;
}
#qrcode { text-align:center; margin-top:15px; }
.kader { padding:10px; border:2px solid gray; border-radius:6px; margin-top:5px; text-align:center; }
.kader.botscan { border-color:blue; }
.kader.schildklier { border-color:green; }
.kader.mibi { border-color:red; }
</style>
</head>
<body>

<h1>Wachttijd instellen</h1>

<label for="time">Terugkomtijd (HH:MM, 24u):</label>
<input type="time" id="time" required>

<div id="onderzoek" class="kader">
  <label for="scan">Selecteer onderzoek:</label>
  <select id="scan">
    <option value="botscan">Botscan</option>
    <option value="schildklier">Schildklierscan</option>
    <option value="mibi">MIBI-scan</option>
  </select>
</div>

<div id="taal">
  <label for="taalkeuze">Selecteer taal:</label>
  <select id="taalkeuze">
    <option value="nl">Nederlands</option>
    <option value="fr">Frans</option>
    <option value="en">Engels</option>
    <option value="uk">OekraÃ¯ens</option>
  </select>
</div>

<label for="phone">Telefoonnummer patiÃ«nt:</label>
<input type="tel" id="phone" placeholder="04xxxxxxxx" value="04" required>

<button onclick="genereerLink()">Genereer link + QR-code</button>

<a id="smsLink">ðŸ“© Verstuur SMS</a>

<div id="qrcode"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script>
function genereerLink() {
  const timeInput = document.getElementById("time").value;
  let phone = document.getElementById("phone").value.trim();
  const scan = document.getElementById("scan").value;
  const taal = document.getElementById("taalkeuze").value;

  if (!timeInput || !phone) { alert("Vul tijd en telefoonnummer in"); return; }
  if (phone.startsWith("0")) { phone = "+32" + phone.substring(1); }

  const [h,m] = timeInput.split(":").map(Number);
  const now = new Date();
  let eind = new Date(now.getFullYear(), now.getMonth(), now.getDate(), h, m, 0);
  if (eind < now) eind.setDate(eind.getDate()+1);
  const endTs = eind.getTime();

  // cache-buster
  const link = `${window.location.origin}/uw-wachttijd.html?end=${endTs}&onderzoek=${scan}&lang=${taal}&v=${Date.now()}`;

  // QR-code
  QRCode.toCanvas(document.getElementById('qrcode'), link, function(err){ if(err)console.error(err); });

  // SMS alleen mobiel
  const smsA = document.getElementById("smsLink");
  const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
  if (isMobile) {
    smsA.href = `sms:${phone}&body=${encodeURIComponent("Uw wachttijd:\n"+link)}`;
    smsA.style.display = "block";
  } else {
    smsA.style.display = "none";
  }

  // kaderkleur aanpassen
  const kader = document.getElementById("onderzoek");
  kader.className = "kader " + scan;
}
</script>
</body>
</html>
