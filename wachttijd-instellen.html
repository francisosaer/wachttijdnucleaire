<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wachttijd instellen</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; text-align: center; }
h1 { font-size: 24px; margin-bottom: 20px; }
label, input, button { font-size: 18px; margin: 10px 0; display: block; width: 80%; max-width: 300px; margin-left: auto; margin-right: auto; }
button { padding: 10px 20px; cursor: pointer; margin-top: 10px; }
#linkOutput { margin-top: 20px; word-break: break-word; color: blue; }
#qrcode canvas { margin-top: 10px; }
</style>
</head>
<body>

<h1>Wachttijd instellen</h1>

<label for="time">Terugkomtijd (HH:MM, 24u):</label>
<input type="time" id="time" required>

<label for="patient">Patiënt naam/nummer (optioneel):</label>
<input type="text" id="patient" placeholder="bijv. Jan Jansen">

<button onclick="genereerLink()">Genereer persoonlijke link</button>

<div id="linkOutput"></div>
<div id="qrcode"></div>

<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<script>
function genereerLink() {
  const timeInput = document.getElementById("time").value;
  const patient = document.getElementById("patient").value.trim();

  if (!timeInput) {
    alert("Vul eerst terugkomtijd in!");
    return;
  }

  // Eindtijd berekenen
  const [hours, minutes] = timeInput.split(":").map(Number);
  const now = new Date();
  let eindTijd = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hours, minutes, 0);
  if (eindTijd < now) eindTijd.setDate(eindTijd.getDate() + 1);
  const endTimestamp = eindTijd.getTime();

  // Dynamische link naar uw-wachttijd.html
  const currentPath = window.location.pathname;
  const basePath = currentPath.substring(0, currentPath.lastIndexOf("/") + 1);
  let link = `${window.location.origin}${basePath}uw-wachttijd.html?end=${endTimestamp}`;
  
  // Voeg optioneel patiëntnaam toe in de URL (niet zichtbaar in timer, enkel voor administratie)
  if (patient) {
    const encoded = encodeURIComponent(patient);
    link += `&patient=${encoded}`;
  }

  // Toon link
  document.getElementById("linkOutput").innerHTML = `
    <p>Persoonlijke link: <a href="${link}" target="_blank">${link}</a></p>
    <button onclick="kopieerLink()">Kopieer link</button>
  `;

  // QR-code genereren
  const qrDiv = document.getElementById('qrcode');
  qrDiv.innerHTML = "";
  const canvas = document.createElement('canvas');
  qrDiv.appendChild(canvas);
  QRCode.toCanvas(canvas, link, function(error) {
    if (error) console.error(error);
  });
}

function kopieerLink() {
  const linkEl = document.querySelector("#linkOutput a");
  if (!linkEl) return;
  navigator.clipboard.writeText(linkEl.href).then(() => {
    alert("Link gekopieerd naar klembord!");
  });
}
</script>

</body>
</html>
